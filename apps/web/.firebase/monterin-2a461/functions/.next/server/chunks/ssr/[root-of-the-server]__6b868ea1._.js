module.exports=[16429,17344,a=>{"use strict";function b(){return(b=Object.assign.bind()).apply(null,arguments)}a.s(["default",()=>b],16429);var c=a.i(57530);a.s(["useThree",()=>c.C],17344)},85044,a=>{"use strict";var b=a.i(57530);a.s(["extend",()=>b.e])},78980,a=>{"use strict";let b=parseInt(a.i(10730).REVISION.replace(/\D+/g,""));a.s(["version",()=>b])},62562,(a,b,c)=>{b.exports=a.x("module",()=>require("module"))},46750,83430,60505,a=>{"use strict";var b,c=a.i(57530);a.s(["useLoader",()=>c.G],46750);var d=a.i(10730);class e extends d.DataTextureLoader{constructor(a){super(a),this.type=d.HalfFloatType}parse(a){let b,c,e,f=function(a,b){switch(a){case 1:throw Error("THREE.RGBELoader: Read Error: "+(b||""));case 2:throw Error("THREE.RGBELoader: Write Error: "+(b||""));case 3:throw Error("THREE.RGBELoader: Bad File Format: "+(b||""));default:throw Error("THREE.RGBELoader: Memory Error: "+(b||""))}},g=function(a,b,c){b=b||1024;let d=a.pos,e=-1,f=0,g="",h=String.fromCharCode.apply(null,new Uint16Array(a.subarray(d,d+128)));for(;0>(e=h.indexOf("\n"))&&f<b&&d<a.byteLength;)g+=h,f+=h.length,d+=128,h+=String.fromCharCode.apply(null,new Uint16Array(a.subarray(d,d+128)));return -1<e&&(!1!==c&&(a.pos+=f+e+1),g+h.slice(0,e))},h=new Uint8Array(a);h.pos=0;let i=function(a){let b,c,d=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,e=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,h=/^\s*FORMAT=(\S+)\s*$/,i=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,j={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};for(!(a.pos>=a.byteLength)&&(b=g(a))||f(1,"no header found"),(c=b.match(/^#\?(\S+)/))||f(3,"bad initial token"),j.valid|=1,j.programtype=c[1],j.string+=b+"\n";!1!==(b=g(a));){if(j.string+=b+"\n","#"===b.charAt(0)){j.comments+=b+"\n";continue}if((c=b.match(d))&&(j.gamma=parseFloat(c[1])),(c=b.match(e))&&(j.exposure=parseFloat(c[1])),(c=b.match(h))&&(j.valid|=2,j.format=c[1]),(c=b.match(i))&&(j.valid|=4,j.height=parseInt(c[1],10),j.width=parseInt(c[2],10)),2&j.valid&&4&j.valid)break}return 2&j.valid||f(3,"missing format specifier"),4&j.valid||f(3,"missing image size specifier"),j}(h),j=i.width,k=i.height,l=function(a,b,c){if(b<8||b>32767||2!==a[0]||2!==a[1]||128&a[2])return new Uint8Array(a);b!==(a[2]<<8|a[3])&&f(3,"wrong scanline width");let d=new Uint8Array(4*b*c);d.length||f(4,"unable to allocate buffer space");let e=0,g=0,h=4*b,i=new Uint8Array(4),j=new Uint8Array(h),k=c;for(;k>0&&g<a.byteLength;){g+4>a.byteLength&&f(1),i[0]=a[g++],i[1]=a[g++],i[2]=a[g++],i[3]=a[g++],(2!=i[0]||2!=i[1]||(i[2]<<8|i[3])!=b)&&f(3,"bad rgbe scanline format");let c=0,l;for(;c<h&&g<a.byteLength;){let b=(l=a[g++])>128;if(b&&(l-=128),(0===l||c+l>h)&&f(3,"bad scanline data"),b){let b=a[g++];for(let a=0;a<l;a++)j[c++]=b}else j.set(a.subarray(g,g+l),c),c+=l,g+=l}for(let a=0;a<b;a++){let c=0;d[e]=j[a+c],c+=b,d[e+1]=j[a+c],c+=b,d[e+2]=j[a+c],c+=b,d[e+3]=j[a+c],e+=4}k--}return d}(h.subarray(h.pos),j,k);switch(this.type){case d.FloatType:let m=new Float32Array(4*(e=l.length/4));for(let a=0;a<e;a++)!function(a,b,c,d){let e=Math.pow(2,a[b+3]-128)/255;c[d+0]=a[b+0]*e,c[d+1]=a[b+1]*e,c[d+2]=a[b+2]*e,c[d+3]=1}(l,4*a,m,4*a);b=m,c=d.FloatType;break;case d.HalfFloatType:let n=new Uint16Array(4*(e=l.length/4));for(let a=0;a<e;a++)!function(a,b,c,e){let f=Math.pow(2,a[b+3]-128)/255;c[e+0]=d.DataUtils.toHalfFloat(Math.min(a[b+0]*f,65504)),c[e+1]=d.DataUtils.toHalfFloat(Math.min(a[b+1]*f,65504)),c[e+2]=d.DataUtils.toHalfFloat(Math.min(a[b+2]*f,65504)),c[e+3]=d.DataUtils.toHalfFloat(1)}(l,4*a,n,4*a);b=n,c=d.HalfFloatType;break;default:throw Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:j,height:k,data:b,header:i.string,gamma:i.gamma,exposure:i.exposure,type:c}}setDataType(a){return this.type=a,this}load(a,b,c,e){return super.load(a,function(a,c){switch(a.type){case d.FloatType:case d.HalfFloatType:"colorSpace"in a?a.colorSpace="srgb-linear":a.encoding=3e3,a.minFilter=d.LinearFilter,a.magFilter=d.LinearFilter,a.generateMipmaps=!1,a.flipY=!0}b&&b(a,c)},c,e)}}a.s(["RGBELoader",()=>e],83430);var f=(0,a.i(62562).createRequire)("/");try{b=f("worker_threads").Worker}catch(a){}var g=b?function(a,c,d,e,f){var g=!1,h=new b(a+";var __w=require('worker_threads');__w.parentPort.on('message',function(m){onmessage({data:m})}),postMessage=function(m,t){__w.parentPort.postMessage(m,t)},close=process.exit;self=global",{eval:!0}).on("error",function(a){return f(a,null)}).on("message",function(a){return f(null,a)}).on("exit",function(a){a&&!g&&f(Error("exited with code "+a),null)});return h.postMessage(d,e),h.terminate=function(){return g=!0,b.prototype.terminate.call(h)},h}:function(a,b,c,d,e){setImmediate(function(){return e(Error("async operations unsupported - update to Node 12+ (or Node 10-11 with the --experimental-worker CLI flag)"),null)});var f=function(){};return{terminate:f,postMessage:f}},h=Uint8Array,i=Uint16Array,j=Uint32Array,k=new h([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),l=new h([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),m=new h([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),n=function(a,b){for(var c=new i(31),d=0;d<31;++d)c[d]=b+=1<<a[d-1];for(var e=new j(c[30]),d=1;d<30;++d)for(var f=c[d];f<c[d+1];++f)e[f]=f-c[d]<<5|d;return[c,e]},o=n(k,2),p=o[0],q=o[1];p[28]=258,q[258]=28;for(var r=n(l,0),s=r[0],t=r[1],u=new i(32768),v=0;v<32768;++v){var w=(43690&v)>>>1|(21845&v)<<1;w=(61680&(w=(52428&w)>>>2|(13107&w)<<2))>>>4|(3855&w)<<4,u[v]=((65280&w)>>>8|(255&w)<<8)>>>1}for(var x=function(a,b,c){for(var d,e=a.length,f=0,g=new i(b);f<e;++f)++g[a[f]-1];var h=new i(b);for(f=0;f<b;++f)h[f]=h[f-1]+g[f-1]<<1;if(c){d=new i(1<<b);var j=15-b;for(f=0;f<e;++f)if(a[f])for(var k=f<<4|a[f],l=b-a[f],m=h[a[f]-1]++<<l,n=m|(1<<l)-1;m<=n;++m)d[u[m]>>>j]=k}else for(f=0,d=new i(e);f<e;++f)a[f]&&(d[f]=u[h[a[f]-1]++]>>>15-a[f]);return d},y=new h(288),v=0;v<144;++v)y[v]=8;for(var v=144;v<256;++v)y[v]=9;for(var v=256;v<280;++v)y[v]=7;for(var v=280;v<288;++v)y[v]=8;for(var z=new h(32),v=0;v<32;++v)z[v]=5;var A=x(y,9,0),B=x(y,9,1),C=x(z,5,0),D=x(z,5,1),E=function(a){for(var b=a[0],c=1;c<a.length;++c)a[c]>b&&(b=a[c]);return b},F=function(a,b,c){var d=b/8|0;return(a[d]|a[d+1]<<8)>>(7&b)&c},G=function(a,b){var c=b/8|0;return(a[c]|a[c+1]<<8|a[c+2]<<16)>>(7&b)},H=function(a){return(a/8|0)+(7&a&&1)},I=function(a,b,c){(null==b||b<0)&&(b=0),(null==c||c>a.length)&&(c=a.length);var d=new(a instanceof i?i:a instanceof j?j:h)(c-b);return d.set(a.subarray(b,c)),d},J=function(a,b,c){var d=a.length;if(!d||c&&!c.l&&d<5)return b||new h(0);var e=!b||c,f=!c||c.i;c||(c={}),b||(b=new h(3*d));var g=function(a){var c=b.length;if(a>c){var d=new h(Math.max(2*c,a));d.set(b),b=d}},i=c.f||0,j=c.p||0,n=c.b||0,o=c.l,q=c.d,r=c.m,t=c.n,u=8*d;do{if(!o){c.f=i=F(a,j,1);var v=F(a,j+1,3);if(j+=3,v)if(1==v)o=B,q=D,r=9,t=5;else if(2==v){var w=F(a,j,31)+257,y=F(a,j+10,15)+4,z=w+F(a,j+5,31)+1;j+=14;for(var A=new h(z),C=new h(19),J=0;J<y;++J)C[m[J]]=F(a,j+3*J,7);j+=3*y;for(var K=E(C),L=(1<<K)-1,M=x(C,K,1),J=0;J<z;){var N=M[F(a,j,L)];j+=15&N;var O=N>>>4;if(O<16)A[J++]=O;else{var P=0,Q=0;for(16==O?(Q=3+F(a,j,3),j+=2,P=A[J-1]):17==O?(Q=3+F(a,j,7),j+=3):18==O&&(Q=11+F(a,j,127),j+=7);Q--;)A[J++]=P}}var R=A.subarray(0,w),S=A.subarray(w);r=E(R),t=E(S),o=x(R,r,1),q=x(S,t,1)}else throw"invalid block type";else{var O=H(j)+4,T=a[O-4]|a[O-3]<<8,U=O+T;if(U>d){if(f)throw"unexpected EOF";break}e&&g(n+T),b.set(a.subarray(O,U),n),c.b=n+=T,c.p=j=8*U;continue}if(j>u){if(f)throw"unexpected EOF";break}}e&&g(n+131072);for(var V=(1<<r)-1,W=(1<<t)-1,X=j;;X=j){var P=o[G(a,j)&V],Y=P>>>4;if((j+=15&P)>u){if(f)throw"unexpected EOF";break}if(!P)throw"invalid length/literal";if(Y<256)b[n++]=Y;else if(256==Y){X=j,o=null;break}else{var Z=Y-254;if(Y>264){var J=Y-257,$=k[J];Z=F(a,j,(1<<$)-1)+p[J],j+=$}var _=q[G(a,j)&W],aa=_>>>4;if(!_)throw"invalid distance";j+=15&_;var S=s[aa];if(aa>3){var $=l[aa];S+=G(a,j)&(1<<$)-1,j+=$}if(j>u){if(f)throw"unexpected EOF";break}e&&g(n+131072);for(var ab=n+Z;n<ab;n+=4)b[n]=b[n-S],b[n+1]=b[n+1-S],b[n+2]=b[n+2-S],b[n+3]=b[n+3-S];n=ab}}c.l=o,c.p=X,c.b=n,o&&(i=1,c.m=r,c.d=q,c.n=t)}while(!i)return n==b.length?b:I(b,0,n)},K=function(a,b,c){c<<=7&b;var d=b/8|0;a[d]|=c,a[d+1]|=c>>>8},L=function(a,b,c){c<<=7&b;var d=b/8|0;a[d]|=c,a[d+1]|=c>>>8,a[d+2]|=c>>>16},M=function(a,b){for(var c=[],d=0;d<a.length;++d)a[d]&&c.push({s:d,f:a[d]});var e=c.length,f=c.slice();if(!e)return[T,0];if(1==e){var g=new h(c[0].s+1);return g[c[0].s]=1,[g,1]}c.sort(function(a,b){return a.f-b.f}),c.push({s:-1,f:25001});var j=c[0],k=c[1],l=0,m=1,n=2;for(c[0]={s:-1,f:j.f+k.f,l:j,r:k};m!=e-1;)j=c[c[l].f<c[n].f?l++:n++],k=c[l!=m&&c[l].f<c[n].f?l++:n++],c[m++]={s:-1,f:j.f+k.f,l:j,r:k};for(var o=f[0].s,d=1;d<e;++d)f[d].s>o&&(o=f[d].s);var p=new i(o+1),q=N(c[m-1],p,0);if(q>b){var d=0,r=0,s=q-b,t=1<<s;for(f.sort(function(a,b){return p[b.s]-p[a.s]||a.f-b.f});d<e;++d){var u=f[d].s;if(p[u]>b)r+=t-(1<<q-p[u]),p[u]=b;else break}for(r>>>=s;r>0;){var v=f[d].s;p[v]<b?r-=1<<b-p[v]++-1:++d}for(;d>=0&&r;--d){var w=f[d].s;p[w]==b&&(--p[w],++r)}q=b}return[new h(p),q]},N=function(a,b,c){return -1==a.s?Math.max(N(a.l,b,c+1),N(a.r,b,c+1)):b[a.s]=c},O=function(a){for(var b=a.length;b&&!a[--b];);for(var c=new i(++b),d=0,e=a[0],f=1,g=function(a){c[d++]=a},h=1;h<=b;++h)if(a[h]==e&&h!=b)++f;else{if(!e&&f>2){for(;f>138;f-=138)g(32754);f>2&&(g(f>10?f-11<<5|28690:f-3<<5|12305),f=0)}else if(f>3){for(g(e),--f;f>6;f-=6)g(8304);f>2&&(g(f-3<<5|8208),f=0)}for(;f--;)g(e);f=1,e=a[h]}return[c.subarray(0,d),b]},P=function(a,b){for(var c=0,d=0;d<b.length;++d)c+=a[d]*b[d];return c},Q=function(a,b,c){var d=c.length,e=H(b+2);a[e]=255&d,a[e+1]=d>>>8,a[e+2]=255^a[e],a[e+3]=255^a[e+1];for(var f=0;f<d;++f)a[e+f+4]=c[f];return(e+4+d)*8},R=function(a,b,c,d,e,f,g,h,j,n,o){K(b,o++,c),++e[256];for(var p,q,r,s,t=M(e,15),u=t[0],v=t[1],w=M(f,15),B=w[0],D=w[1],E=O(u),F=E[0],G=E[1],H=O(B),I=H[0],J=H[1],N=new i(19),R=0;R<F.length;++R)N[31&F[R]]++;for(var R=0;R<I.length;++R)N[31&I[R]]++;for(var S=M(N,7),T=S[0],U=S[1],V=19;V>4&&!T[m[V-1]];--V);var W=n+5<<3,X=P(e,y)+P(f,z)+g,Y=P(e,u)+P(f,B)+g+14+3*V+P(N,T)+(2*N[16]+3*N[17]+7*N[18]);if(W<=X&&W<=Y)return Q(b,o,a.subarray(j,j+n));if(K(b,o,1+(Y<X)),o+=2,Y<X){p=x(u,v,0),q=u,r=x(B,D,0),s=B;var Z=x(T,U,0);K(b,o,G-257),K(b,o+5,J-1),K(b,o+10,V-4),o+=14;for(var R=0;R<V;++R)K(b,o+3*R,T[m[R]]);o+=3*V;for(var $=[F,I],_=0;_<2;++_)for(var aa=$[_],R=0;R<aa.length;++R){var ab=31&aa[R];K(b,o,Z[ab]),o+=T[ab],ab>15&&(K(b,o,aa[R]>>>5&127),o+=aa[R]>>>12)}}else p=A,q=y,r=C,s=z;for(var R=0;R<h;++R)if(d[R]>255){var ab=d[R]>>>18&31;L(b,o,p[ab+257]),o+=q[ab+257],ab>7&&(K(b,o,d[R]>>>23&31),o+=k[ab]);var ac=31&d[R];L(b,o,r[ac]),o+=s[ac],ac>3&&(L(b,o,d[R]>>>5&8191),o+=l[ac])}else L(b,o,p[d[R]]),o+=q[d[R]];return L(b,o,p[256]),o+q[256]},S=new j([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),T=new h(0),U=function(a,b,c,d,e,f){var g=a.length,m=new h(d+g+5*(1+Math.ceil(g/7e3))+e),n=m.subarray(d,m.length-e),o=0;if(!b||g<8)for(var p=0;p<=g;p+=65535){var r=p+65535;r<g?o=Q(n,o,a.subarray(p,r)):(n[p]=f,o=Q(n,o,a.subarray(p,g)))}else{for(var s=S[b-1],u=s>>>13,v=8191&s,w=(1<<c)-1,x=new i(32768),y=new i(w+1),z=Math.ceil(c/3),A=2*z,B=function(b){return(a[b]^a[b+1]<<z^a[b+2]<<A)&w},C=new j(25e3),D=new i(288),E=new i(32),F=0,G=0,p=0,J=0,K=0,L=0;p<g;++p){var M=B(p),N=32767&p,O=y[M];if(x[N]=O,y[M]=N,K<=p){var P=g-p;if((F>7e3||J>24576)&&P>423){o=R(a,n,0,C,D,E,G,J,L,p-L,o),J=F=G=0,L=p;for(var U=0;U<286;++U)D[U]=0;for(var U=0;U<30;++U)E[U]=0}var V=2,W=0,X=v,Y=N-O&32767;if(P>2&&M==B(p-Y))for(var Z=Math.min(u,P)-1,$=Math.min(32767,p),_=Math.min(258,P);Y<=$&&--X&&N!=O;){if(a[p+V]==a[p+V-Y]){for(var aa=0;aa<_&&a[p+aa]==a[p+aa-Y];++aa);if(aa>V){if(V=aa,W=Y,aa>Z)break;for(var ab=Math.min(Y,aa-2),ac=0,U=0;U<ab;++U){var ad=p-Y+U+32768&32767,ae=x[ad],af=ad-ae+32768&32767;af>ac&&(ac=af,O=ad)}}}O=x[N=O],Y+=N-O+32768&32767}if(W){C[J++]=0x10000000|q[V]<<18|t[W];var ag=31&q[V],ah=31&t[W];G+=k[ag]+l[ah],++D[257+ag],++E[ah],K=p+V,++F}else C[J++]=a[p],++D[a[p]]}}o=R(a,n,f,C,D,E,G,J,L,p-L,o),!f&&7&o&&(o=Q(n,o+1,T))}return I(m,0,d+H(o)+e)},V=function(){for(var a=new Int32Array(256),b=0;b<256;++b){for(var c=b,d=9;--d;)c=(1&c&&-0x12477ce0)^c>>>1;a[b]=c}return a}(),W=function(){var a=-1;return{p:function(b){for(var c=a,d=0;d<b.length;++d)c=V[255&c^b[d]]^c>>>8;a=c},d:function(){return~a}}},X=function(){var a=1,b=0;return{p:function(c){for(var d=a,e=b,f=c.length,g=0;g!=f;){for(var h=Math.min(g+2655,f);g<h;++g)e+=d+=c[g];d=(65535&d)+15*(d>>16),e=(65535&e)+15*(e>>16)}a=d,b=e},d:function(){return a%=65521,b%=65521,(255&a)<<24|a>>>8<<16|(255&b)<<8|b>>>8}}},Y=function(a,b,c,d,e){return U(a,null==b.level?6:b.level,null==b.mem?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(a.length)))):12+b.mem,c,d,!e)},Z=function(a,b){var c={};for(var d in a)c[d]=a[d];for(var d in b)c[d]=b[d];return c},$=function(a,b,c){for(var d=a(),e=a.toString(),f=e.slice(e.indexOf("[")+1,e.lastIndexOf("]")).replace(/ /g,"").split(","),g=0;g<d.length;++g){var h=d[g],i=f[g];if("function"==typeof h){b+=";"+i+"=";var j=h.toString();if(h.prototype)if(-1!=j.indexOf("[native code]")){var k=j.indexOf(" ",8)+1;b+=j.slice(k,j.indexOf("(",k))}else for(var l in b+=j,h.prototype)b+=";"+i+".prototype."+l+"="+h.prototype[l].toString();else b+=j}else c[i]=h}return[b,c]},_=[],aa=function(a){var b=[];for(var c in a)(a[c]instanceof h||a[c]instanceof i||a[c]instanceof j)&&b.push((a[c]=new a[c].constructor(a[c])).buffer);return b},ab=function(a,b,c,d){if(!_[c]){for(var e,f="",h={},i=a.length-1,j=0;j<i;++j)f=(e=$(a[j],f,h))[0],h=e[1];_[c]=$(a[i],f,h)}var k=Z({},_[c][1]);return g(_[c][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+b.toString()+"}",c,k,aa(k),d)},ac=function(){return[h,i,j,k,l,m,p,s,B,D,u,x,E,F,G,H,I,J,aA,ag,ah]},ad=function(){return[h,i,j,k,l,m,q,t,A,y,C,z,u,S,T,x,K,L,M,N,O,P,Q,R,H,I,U,Y,ax,ag]},ae=function(){return[ap,aq]},af=function(){return[at]},ag=function(a){return postMessage(a,[a.buffer])},ah=function(a){return a&&a.size&&new h(a.size)},ai=function(a){return a.ondata=function(a,b){return postMessage([a,b],[a.buffer])},function(b){return a.push(b.data[0],b.data[1])}},aj=function(a,b,c,d,e){var f,g=ab(a,d,e,function(a,c){a?(g.terminate(),b.ondata.call(b,a)):(c[1]&&g.terminate(),b.ondata.call(b,a,c[0],c[1]))});g.postMessage(c),b.push=function(a,c){if(f)throw"stream finished";if(!b.ondata)throw"no stream handler";g.postMessage([a,f=c],[a.buffer])},b.terminate=function(){g.terminate()}},ak=function(a,b){return a[b]|a[b+1]<<8},al=function(a,b){return(a[b]|a[b+1]<<8|a[b+2]<<16|a[b+3]<<24)>>>0},am=function(a,b){return al(a,b)+0x100000000*al(a,b+4)},an=function(a,b,c){for(;c;++b)a[b]=c,c>>>=8},ao=function(a,b){var c=b.filename;if(a[0]=31,a[1]=139,a[2]=8,a[8]=b.level<2?4:2*(9==b.level),a[9]=3,0!=b.mtime&&an(a,4,Math.floor(new Date(b.mtime||Date.now())/1e3)),c){a[3]=8;for(var d=0;d<=c.length;++d)a[d+10]=c.charCodeAt(d)}},ap=function(a){if(31!=a[0]||139!=a[1]||8!=a[2])throw"invalid gzip data";var b=a[3],c=10;4&b&&(c+=a[10]|(a[11]<<8)+2);for(var d=(b>>3&1)+(b>>4&1);d>0;d-=!a[c++]);return c+(2&b)},aq=function(a){var b=a.length;return(a[b-4]|a[b-3]<<8|a[b-2]<<16|a[b-1]<<24)>>>0},ar=function(a){return 10+(a.filename&&a.filename.length+1||0)},as=function(a,b){var c=b.level,d=0==c?0:c<6?1:9==c?3:2;a[0]=120,a[1]=d<<6|(d?32-2*d:1)},at=function(a){if((15&a[0])!=8||a[0]>>>4>7||(a[0]<<8|a[1])%31)throw"invalid zlib data";if(32&a[1])throw"invalid zlib data: preset dictionaries not supported"};function au(a,b){return b||"function"!=typeof a||(b=a,a={}),this.ondata=b,a}var av=function(){function a(a,b){b||"function"!=typeof a||(b=a,a={}),this.ondata=b,this.o=a||{}}return a.prototype.p=function(a,b){this.ondata(Y(a,this.o,0,0,!b),b)},a.prototype.push=function(a,b){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=b,this.p(a,b||!1)},a}(),aw=function(a,b){aj([ad,function(){return[ai,av]}],this,au.call(this,a,b),function(a){onmessage=ai(new av(a.data))},6)};function ax(a,b){return Y(a,b||{},0,0)}var ay=function(){function a(a){this.s={},this.p=new h(0),this.ondata=a}return a.prototype.e=function(a){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var b=this.p.length,c=new h(b+a.length);c.set(this.p),c.set(a,b),this.p=c},a.prototype.c=function(a){this.d=this.s.i=a||!1;var b=this.s.b,c=J(this.p,this.o,this.s);this.ondata(I(c,b,this.s.b),this.d),this.o=I(c,this.s.b-32768),this.s.b=this.o.length,this.p=I(this.p,this.s.p/8|0),this.s.p&=7},a.prototype.push=function(a,b){this.e(a),this.c(b)},a}(),az=function(a){this.ondata=a,aj([ac,function(){return[ai,ay]}],this,0,function(){onmessage=ai(new ay)},7)};function aA(a,b){return J(a,b)}(function(){function a(a,b){this.c=W(),this.l=0,this.v=1,av.call(this,a,b)}a.prototype.push=function(a,b){av.prototype.push.call(this,a,b)},a.prototype.p=function(a,b){this.c.p(a),this.l+=a.length;var c=Y(a,this.o,this.v&&ar(this.o),b&&8,!b);this.v&&(ao(c,this.o),this.v=0),b&&(an(c,c.length-8,this.c.d()),an(c,c.length-4,this.l)),this.ondata(c,b)}})();var aB=function(){function a(a){this.v=1,ay.call(this,a)}return a.prototype.push=function(a,b){if(ay.prototype.e.call(this,a),this.v){var c=this.p.length>3?ap(this.p):4;if(c>=this.p.length&&!b)return;this.p=this.p.subarray(c),this.v=0}if(b){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}ay.prototype.c.call(this,b)},a}(),aC=function(a){this.ondata=a,aj([ac,ae,function(){return[ai,ay,aB]}],this,0,function(){onmessage=ai(new aB)},9)},aD=(function(){function a(a,b){this.c=X(),this.v=1,av.call(this,a,b)}a.prototype.push=function(a,b){av.prototype.push.call(this,a,b)},a.prototype.p=function(a,b){this.c.p(a);var c=Y(a,this.o,this.v&&2,b&&4,!b);this.v&&(as(c,this.o),this.v=0),b&&an(c,c.length-4,this.c.d()),this.ondata(c,b)}}(),function(){function a(a){this.v=1,ay.call(this,a)}return a.prototype.push=function(a,b){if(ay.prototype.e.call(this,a),this.v){if(this.p.length<2&&!b)return;this.p=this.p.subarray(2),this.v=0}if(b){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}ay.prototype.c.call(this,b)},a}()),aE=function(a){this.ondata=a,aj([ac,af,function(){return[ai,ay,aD]}],this,0,function(){onmessage=ai(new aD)},11)};function aF(a,b){return J((at(a),a.subarray(2,-4)),b)}var aG=function(){function a(a){this.G=aB,this.I=ay,this.Z=aD,this.ondata=a}return a.prototype.push=function(a,b){if(!this.ondata)throw"no stream handler";if(this.s)this.s.push(a,b);else{if(this.p&&this.p.length){var c=new h(this.p.length+a.length);c.set(this.p),c.set(a,this.p.length)}else this.p=a;if(this.p.length>2){var d=this,e=function(){d.ondata.apply(d,arguments)};this.s=31==this.p[0]&&139==this.p[1]&&8==this.p[2]?new this.G(e):(15&this.p[0])!=8||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(e):new this.Z(e),this.s.push(this.p,b),this.p=null}}},a}();(function(a){this.G=aC,this.I=az,this.Z=aE,this.ondata=a}).prototype.push=function(a,b){aG.prototype.push.call(this,a,b)};var aH="undefined"!=typeof TextEncoder&&new TextEncoder,aI="undefined"!=typeof TextDecoder&&new TextDecoder,aJ=0;try{aI.decode(T,{stream:!0}),aJ=1}catch(a){}var aK=function(a){for(var b="",c=0;;){var d=a[c++],e=(d>127)+(d>223)+(d>239);if(c+e>a.length)return[b,I(a,c-1)];e?3==e?b+=String.fromCharCode(55296|(d=((15&d)<<18|(63&a[c++])<<12|(63&a[c++])<<6|63&a[c++])-65536)>>10,56320|1023&d):1&e?b+=String.fromCharCode((31&d)<<6|63&a[c++]):b+=String.fromCharCode((15&d)<<12|(63&a[c++])<<6|63&a[c++]):b+=String.fromCharCode(d)}};function aL(a,b){if(b){for(var c=new h(a.length),d=0;d<a.length;++d)c[d]=a.charCodeAt(d);return c}if(aH)return aH.encode(a);for(var e=a.length,f=new h(a.length+(a.length>>1)),g=0,i=function(a){f[g++]=a},d=0;d<e;++d){if(g+5>f.length){var j=new h(g+8+(e-d<<1));j.set(f),f=j}var k=a.charCodeAt(d);k<128||b?i(k):(k<2048?i(192|k>>6):(k>55295&&k<57344?(i(240|(k=65536+(1047552&k)|1023&a.charCodeAt(++d))>>18),i(128|k>>12&63)):i(224|k>>12),i(128|k>>6&63)),i(128|63&k))}return I(f,0,g)}(function(a){this.ondata=a,aJ?this.t=new TextDecoder:this.p=T}).prototype.push=function(a,b){if(!this.ondata)throw"no callback";if(b=!!b,this.t){if(this.ondata(this.t.decode(a,{stream:!0}),b),b){if(this.t.decode().length)throw"invalid utf-8 data";this.t=null}return}if(!this.p)throw"stream finished";var c=new h(this.p.length+a.length);c.set(this.p),c.set(a,this.p.length);var d=aK(c),e=d[0],f=d[1];if(b){if(f.length)throw"invalid utf-8 data";this.p=null}else this.p=f;this.ondata(e,b)},(function(a){this.ondata=a}).prototype.push=function(a,b){if(!this.ondata)throw"no callback";if(this.d)throw"stream finished";this.ondata(aL(a),this.d=b||!1)};var aM=function(a){return 1==a?3:a<6?2:+(9==a)},aN=function(a,b){for(;1!=ak(a,b);b+=4+ak(a,b+2));return[am(a,b+12),am(a,b+4),am(a,b+20)]},aO=function(a){var b=0;if(a)for(var c in a){var d=a[c].length;if(d>65535)throw"extra field too long";b+=d+4}return b},aP=function(a,b,c,d,e,f,g,h){var i=d.length,j=c.extra,k=h&&h.length,l=aO(j);an(a,b,null!=g?0x2014b50:0x4034b50),b+=4,null!=g&&(a[b++]=20,a[b++]=c.os),a[b]=20,b+=2,a[b++]=c.flag<<1|(null==f&&8),a[b++]=e&&8,a[b++]=255&c.compression,a[b++]=c.compression>>8;var m=new Date(null==c.mtime?Date.now():c.mtime),n=m.getFullYear()-1980;if(n<0||n>119)throw"date not in range 1980-2099";if(an(a,b,n<<25|m.getMonth()+1<<21|m.getDate()<<16|m.getHours()<<11|m.getMinutes()<<5|m.getSeconds()>>>1),b+=4,null!=f&&(an(a,b,c.crc),an(a,b+4,f),an(a,b+8,c.size)),an(a,b+12,i),an(a,b+14,l),b+=16,null!=g&&(an(a,b,k),an(a,b+6,c.attrs),an(a,b+10,g),b+=14),a.set(d,b),b+=i,l)for(var o in j){var p=j[o],q=p.length;an(a,b,+o),an(a,b+2,q),a.set(p,b+4),b+=4+q}return k&&(a.set(h,b),b+=k),b},aQ=function(a,b,c,d,e){an(a,b,0x6054b50),an(a,b+8,c),an(a,b+10,c),an(a,b+12,d),an(a,b+16,e)},aR=function(){function a(a){this.filename=a,this.c=W(),this.size=0,this.compression=0}return a.prototype.process=function(a,b){this.ondata(null,a,b)},a.prototype.push=function(a,b){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(a),this.size+=a.length,b&&(this.crc=this.c.d()),this.process(a,b||!1)},a}();function aS(a,b){var c=this;b||(b={}),aR.call(this,a),this.d=new av(b,function(a,b){c.ondata(null,a,b)}),this.compression=8,this.flag=aM(b.level)}function aT(a,b){var c=this;b||(b={}),aR.call(this,a),this.d=new aw(b,function(a,b,d){c.ondata(a,b,d)}),this.compression=8,this.flag=aM(b.level),this.terminate=this.d.terminate}function aU(a){this.ondata=a,this.u=[],this.d=1}aS.prototype.process=function(a,b){try{this.d.push(a,b)}catch(a){this.ondata(a,null,b)}},aS.prototype.push=function(a,b){aR.prototype.push.call(this,a,b)},aT.prototype.process=function(a,b){this.d.push(a,b)},aT.prototype.push=function(a,b){aR.prototype.push.call(this,a,b)},aU.prototype.add=function(a){var b=this;if(2&this.d)throw"stream finished";var c=aL(a.filename),d=c.length,e=a.comment,f=e&&aL(e),g=d!=a.filename.length||f&&e.length!=f.length,i=d+aO(a.extra)+30;if(d>65535)throw"filename too long";var j=new h(i);aP(j,0,a,c,g);var k=[j],l=function(){for(var a=0,c=k;a<c.length;a++){var d=c[a];b.ondata(null,d,!1)}k=[]},m=this.d;this.d=0;var n=this.u.length,o=Z(a,{f:c,u:g,o:f,t:function(){a.terminate&&a.terminate()},r:function(){if(l(),m){var a=b.u[n+1];a?a.r():b.d=1}m=1}}),p=0;a.ondata=function(c,d,e){if(c)b.ondata(c,d,e),b.terminate();else if(p+=d.length,k.push(d),e){var f=new h(16);an(f,0,0x8074b50),an(f,4,a.crc),an(f,8,p),an(f,12,a.size),k.push(f),o.c=p,o.b=i+p+16,o.crc=a.crc,o.size=a.size,m&&o.r(),m=1}else m&&l()},this.u.push(o)},aU.prototype.end=function(){var a=this;if(2&this.d){if(1&this.d)throw"stream finishing";throw"stream finished"}this.d?this.e():this.u.push({r:function(){1&a.d&&(a.u.splice(-1,1),a.e())},t:function(){}}),this.d=3},aU.prototype.e=function(){for(var a=0,b=0,c=0,d=0,e=this.u;d<e.length;d++){var f=e[d];c+=46+f.f.length+aO(f.extra)+(f.o?f.o.length:0)}for(var g=new h(c+22),i=0,j=this.u;i<j.length;i++){var f=j[i];aP(g,a,f,f.f,f.u,f.c,b,f.o),a+=46+f.f.length+aO(f.extra)+(f.o?f.o.length:0),b+=f.b}aQ(g,a,this.u.length,c,b),this.ondata(null,g,!0),this.d=2},aU.prototype.terminate=function(){for(var a=0,b=this.u;a<b.length;a++)b[a].t();this.d=2};var aV=function(){function a(){}return a.prototype.push=function(a,b){this.ondata(null,a,b)},a.compression=0,a}();function aW(){var a=this;this.i=new ay(function(b,c){a.ondata(null,b,c)})}function aX(a,b){var c=this;b<32e4?this.i=new ay(function(a,b){c.ondata(null,a,b)}):(this.i=new az(function(a,b,d){c.ondata(a,b,d)}),this.terminate=this.i.terminate)}function aY(a){this.onfile=a,this.k=[],this.o={0:aV},this.p=T}aW.prototype.push=function(a,b){try{this.i.push(a,b)}catch(c){this.ondata(c,a,b)}},aW.compression=8,aX.prototype.push=function(a,b){this.i.terminate&&(a=I(a,0)),this.i.push(a,b)},aX.compression=8,aY.prototype.push=function(a,b){var c=this;if(!this.onfile)throw"no callback";if(!this.p)throw"stream finished";if(this.c>0){var d=Math.min(this.c,a.length),e=a.subarray(0,d);if(this.c-=d,this.d?this.d.push(e,!this.c):this.k[0].push(e),(a=a.subarray(d)).length)return this.push(a,b)}else{var f=0,g=0,i=void 0,j=void 0;this.p.length?a.length?((j=new h(this.p.length+a.length)).set(this.p),j.set(a,this.p.length)):j=this.p:j=a;for(var k=j.length,l=this.c,m=l&&this.d,n=this;g<k-4&&"break"!==function(){var a=al(j,g);if(0x4034b50==a){f=1,i=g,n.d=null,n.c=0;var b=ak(j,g+6),d=ak(j,g+8),e=8&b,h=ak(j,g+26),m=ak(j,g+28);if(k>g+30+h+m){var o,p,q=[];n.k.unshift(q),f=2;var r=al(j,g+18),s=al(j,g+22),t=function(a,b){if(b){for(var c="",d=0;d<a.length;d+=16384)c+=String.fromCharCode.apply(null,a.subarray(d,d+16384));return c}if(aI)return aI.decode(a);var e=aK(a),f=e[0];if(e[1].length)throw"invalid utf-8 data";return f}(j.subarray(g+30,g+=30+h),!(2048&b));0xffffffff==r?(r=(o=e?[-2]:aN(j,g))[0],s=o[1]):e&&(r=-1),g+=m,n.c=r;var u={name:t,compression:d,start:function(){if(!u.ondata)throw"no callback";if(r){var a=c.o[d];if(!a)throw"unknown compression type "+d;(p=r<0?new a(t):new a(t,r,s)).ondata=function(a,b,c){u.ondata(a,b,c)};for(var b=0;b<q.length;b++){var e=q[b];p.push(e,!1)}c.k[0]==q&&c.c?c.d=p:p.push(T,!0)}else u.ondata(null,T,!0)},terminate:function(){p&&p.terminate&&p.terminate()}};r>=0&&(u.size=r,u.originalSize=s),n.onfile(u)}return"break"}if(l){if(0x8074b50==a)return i=g+=12+(-2==l&&8),f=3,n.c=0,"break";else if(0x2014b50==a)return i=g-=4,f=3,n.c=0,"break"}}();++g);if(this.p=T,l<0){var o=f?j.subarray(0,i-12-(-2==l&&8)-(0x8074b50==al(j,i-16)&&4)):j.subarray(0,g);m?m.push(o,!!f):this.k[+(2==f)].push(o)}if(2&f)return this.push(j.subarray(g),b);this.p=j.subarray(g)}if(b){if(this.c)throw"invalid zip file";this.p=null}},aY.prototype.register=function(a){this.o[a.compression]=a},a.s(["unzlibSync",()=>aF],60505)},15523,a=>{"use strict";let b;var c=a.i(17344),d=a.i(46750),e=a.i(10730),f=a.i(83430),g=e,h=a.i(60505);let i=a.i(78980).version>=152;class j extends g.DataTextureLoader{constructor(a){super(a),this.type=g.HalfFloatType}parse(a){let b={l:0,c:0,lc:0};function c(a,c,d,e,f){for(;d<a;)c=c<<8|C(e,f),d+=8;b.l=c>>(d-=a)&(1<<a)-1,b.c=c,b.lc=d}let d=Array(59),e={c:0,lc:0};function f(a,b,c,d){a=a<<8|C(c,d),b+=8,e.c=a,e.lc=b}let j={c:0,lc:0};function k(a,b,c,d,g,h,i,k,l,m){if(a==b){d<8&&(f(c,d,g,i),c=e.c,d=e.lc);var n=c>>(d-=8),n=new Uint8Array([n])[0];if(l.value+n>m)return!1;for(var o=k[l.value-1];n-- >0;)k[l.value++]=o}else{if(!(l.value<m))return!1;k[l.value++]=a}j.c=c,j.lc=d}function l(a){var b=65535&a;return b>32767?b-65536:b}let m={a:0,b:0};function n(a,b){var c=l(a),d=l(b),e=c+(1&d)+(d>>1),f=e-d;m.a=e,m.b=f}function o(a,b){var c=65535&b,d=(65535&a)-(c>>1)&65535;m.a=c+d-32768&65535,m.b=d}function p(a,g,h,i,l,m){var n=h.value,o=B(g,h),p=B(g,h);h.value+=4;var q=B(g,h);if(h.value+=4,o<0||o>=65537||p<0||p>=65537)throw"Something wrong with HUF_ENCSIZE";for(var r=Array(65537),s=Array(16384),t=0;t<16384;t++)s[t]={},s[t].len=0,s[t].lit=0,s[t].p=null;var u=i-(h.value-n);if(!function(a,e,f,g,h,i,j){for(var k=0,l=0;h<=i;h++){if(f.value-f.value>g)return!1;c(6,k,l,a,f);var m=b.l;if(k=b.c,l=b.lc,j[h]=m,63==m){if(f.value-f.value>g)throw"Something wrong with hufUnpackEncTable";c(8,k,l,a,f);var n=b.l+6;if(k=b.c,l=b.lc,h+n>i+1)throw"Something wrong with hufUnpackEncTable";for(;n--;)j[h++]=0;h--}else if(m>=59){var n=m-59+2;if(h+n>i+1)throw"Something wrong with hufUnpackEncTable";for(;n--;)j[h++]=0;h--}}!function(a){for(var b=0;b<=58;++b)d[b]=0;for(var b=0;b<65537;++b)d[a[b]]+=1;for(var c=0,b=58;b>0;--b){var e=c+d[b]>>1;d[b]=c,c=e}for(var b=0;b<65537;++b){var f=a[b];f>0&&(a[b]=f|d[f]++<<6)}}(j)}(a,0,h,u,o,p,r),q>8*(i-(h.value-n)))throw"Something wrong with hufUncompress";!function(a,b,c,d){for(;b<=c;b++){var e=a[b]>>6,f=63&a[b];if(e>>f)throw"Invalid table entry";if(f>14){var g=d[e>>f-14];if(g.len)throw"Invalid table entry";if(g.lit++,g.p){var h=g.p;g.p=Array(g.lit);for(var i=0;i<g.lit-1;++i)g.p[i]=h[i]}else g.p=[,];g.p[g.lit-1]=b}else if(f)for(var j=0,i=1<<14-f;i>0;i--){var g=d[(e<<14-f)+j];if(g.len||g.p)throw"Invalid table entry";g.len=f,g.lit=b,j++}}}(r,o,p,s),function(a,b,c,d,g,h,i,l,m,n){for(var o=0,p=0,q=Math.trunc(g.value+(h+7)/8);g.value<q;)for(f(o,p,c,g),o=e.c,p=e.lc;p>=14;){var r=b[o>>p-14&16383];if(r.len)p-=r.len,k(r.lit,i,o,p,c,d,g,m,n,l),o=j.c,p=j.lc;else{if(!r.p)throw"hufDecode issues";for(s=0;s<r.lit;s++){for(var s,t=63&a[r.p[s]];p<t&&g.value<q;)f(o,p,c,g),o=e.c,p=e.lc;if(p>=t&&a[r.p[s]]>>6==(o>>p-t&(1<<t)-1)){p-=t,k(r.p[s],i,o,p,c,d,g,m,n,l),o=j.c,p=j.lc;break}}if(s==r.lit)throw"hufDecode issues"}}var u=8-h&7;for(o>>=u,p-=u;p>0;){var r=b[o<<14-p&16383];if(r.len)p-=r.len,k(r.lit,i,o,p,c,d,g,m,n,l),o=j.c,p=j.lc;else throw"hufDecode issues"}}(r,s,a,g,h,q,p,m,l,{value:0})}function q(a){for(var b=1;b<a.length;b++){var c=a[b-1]+a[b]-128;a[b]=c}}function r(a,b){for(var c=0,d=Math.floor((a.length+1)/2),e=0,f=a.length-1;!(e>f)&&(b[e++]=a[c++],!(e>f));){;b[e++]=a[d++]}}function s(a){for(var b=a.byteLength,c=[],d=0,e=new DataView(a);b>0;){var f=e.getInt8(d++);if(f<0){var g=-f;b-=g+1;for(var h=0;h<g;h++)c.push(e.getUint8(d++))}else{var g=f;b-=2;for(var i=e.getUint8(d++),h=0;h<g+1;h++)c.push(i)}}return c}function t(a){return new DataView(a.array.buffer,a.offset.value,a.size)}function u(a){var b=new Uint8Array(s(a.viewer.buffer.slice(a.offset.value,a.offset.value+a.size))),c=new Uint8Array(b.length);return q(b),r(b,c),new DataView(c.buffer)}function v(a){var b=a.array.slice(a.offset.value,a.offset.value+a.size),c=(0,h.unzlibSync)(b),d=new Uint8Array(c.length);return q(c),r(c,d),new DataView(d.buffer)}function w(a){for(var b=a.viewer,c={value:a.offset.value},d=new Uint16Array(a.width*a.scanlineBlockSize*(a.channels*a.type)),e=new Uint8Array(8192),f=0,g=Array(a.channels),h=0;h<a.channels;h++)g[h]={},g[h].start=f,g[h].end=g[h].start,g[h].nx=a.width,g[h].ny=a.lines,g[h].size=a.type,f+=g[h].nx*g[h].ny*g[h].size;var i=I(b,c),j=I(b,c);if(j>=8192)throw"Something is wrong with PIZ_COMPRESSION BITMAP_SIZE";if(i<=j)for(var h=0;h<j-i+1;h++)e[h+i]=D(b,c);var k=new Uint16Array(65536),l=function(a,b){for(var c=0,d=0;d<65536;++d)(0==d||a[d>>3]&1<<(7&d))&&(b[c++]=d);for(var e=c-1;c<65536;)b[c++]=0;return e}(e,k),q=B(b,c);p(a.array,b,c,q,d,f);for(var h=0;h<a.channels;++h)for(var r=g[h],s=0;s<g[h].size;++s)!function(a,b,c,d,e,f,g){for(var h=g<16384,i=c>e?e:c,j=1;j<=i;)j<<=1;for(j>>=1,k=j,j>>=1;j>=1;){for(var k,l,p,q,r,s=0,t=0+f*(e-k),u=f*j,v=f*k,w=d*j,x=d*k;s<=t;s+=v){for(var y=s,z=s+d*(c-k);y<=z;y+=x){var A=y+w,B=y+u,C=B+w;h?(n(a[y+b],a[B+b]),l=m.a,q=m.b,n(a[A+b],a[C+b]),p=m.a,r=m.b,n(l,p),a[y+b]=m.a,a[A+b]=m.b,n(q,r)):(o(a[y+b],a[B+b]),l=m.a,q=m.b,o(a[A+b],a[C+b]),p=m.a,r=m.b,o(l,p),a[y+b]=m.a,a[A+b]=m.b,o(q,r)),a[B+b]=m.a,a[C+b]=m.b}if(c&j){var B=y+u;h?n(a[y+b],a[B+b]):o(a[y+b],a[B+b]),l=m.a,a[B+b]=m.b,a[y+b]=l}}if(e&j)for(var y=s,z=s+d*(c-k);y<=z;y+=x){var A=y+w;h?n(a[y+b],a[A+b]):o(a[y+b],a[A+b]),l=m.a,a[A+b]=m.b,a[y+b]=l}k=j,j>>=1}}(d,r.start+s,r.nx,r.size,r.ny,r.nx*r.size,l);for(var t=f,u=0;u<t;++u)d[u]=k[d[u]];for(var v=0,w=new Uint8Array(d.buffer.byteLength),x=0;x<a.lines;x++)for(var y=0;y<a.channels;y++){var r=g[y],z=r.nx*r.size,A=new Uint8Array(d.buffer,2*r.end,2*z);w.set(A,v),v+=2*z,r.end+=z}return new DataView(w.buffer)}function x(a){var b=a.array.slice(a.offset.value,a.offset.value+a.size),c=(0,h.unzlibSync)(b);let d=a.lines*a.channels*a.width,e=1==a.type?new Uint16Array(d):new Uint32Array(d),f=0,g=0,i=[,,,,];for(let b=0;b<a.lines;b++)for(let b=0;b<a.channels;b++){let b=0;switch(a.type){case 1:i[0]=f,i[1]=i[0]+a.width,f=i[1]+a.width;for(let d=0;d<a.width;++d)b+=c[i[0]++]<<8|c[i[1]++],e[g]=b,g++;break;case 2:i[0]=f,i[1]=i[0]+a.width,i[2]=i[1]+a.width,f=i[2]+a.width;for(let d=0;d<a.width;++d)b+=c[i[0]++]<<24|c[i[1]++]<<16|c[i[2]++]<<8,e[g]=b,g++}}return new DataView(e.buffer)}function y(a){var b=a.viewer,c={value:a.offset.value},d=new Uint8Array(a.width*a.lines*(a.channels*a.type*2)),e={version:E(b,c),unknownUncompressedSize:E(b,c),unknownCompressedSize:E(b,c),acCompressedSize:E(b,c),dcCompressedSize:E(b,c),rleCompressedSize:E(b,c),rleUncompressedSize:E(b,c),rleRawSize:E(b,c),totalAcUncompressedCount:E(b,c),totalDcUncompressedCount:E(b,c),acCompression:E(b,c)};if(e.version<2)throw"EXRLoader.parse: "+N.compression+" version "+e.version+" is unsupported";for(var f=[],i=I(b,c)-2;i>0;){var j=z(b.buffer,c),k=D(b,c),l=k>>2&3,m=new Int8Array([(k>>4)-1])[0],n=D(b,c);f.push({name:j,index:m,type:n,compression:l}),i-=j.length+3}for(var o=N.channels,q=Array(a.channels),r=0;r<a.channels;++r){var t=q[r]={},u=o[r];t.name=u.name,t.compression=0,t.decoded=!1,t.type=u.pixelType,t.pLinear=u.pLinear,t.width=a.width,t.height=a.lines}for(var w={idx:[,,,]},x=0;x<a.channels;++x)for(var t=q[x],r=0;r<f.length;++r){var y=f[r];t.name==y.name&&(t.compression=y.compression,y.index>=0&&(w.idx[y.index]=x),t.offset=x)}if(e.acCompressedSize>0)switch(e.acCompression){case 0:var A=new Uint16Array(e.totalAcUncompressedCount);p(a.array,b,c,e.acCompressedSize,A,e.totalAcUncompressedCount);break;case 1:var B=a.array.slice(c.value,c.value+e.totalAcUncompressedCount),C=(0,h.unzlibSync)(B),A=new Uint16Array(C.buffer);c.value+=e.totalAcUncompressedCount}if(e.dcCompressedSize>0){var F=new Uint16Array(v({array:a.array,offset:c,size:e.dcCompressedSize}).buffer);c.value+=e.dcCompressedSize}if(e.rleRawSize>0){var B=a.array.slice(c.value,c.value+e.rleCompressedSize),C=(0,h.unzlibSync)(B),G=s(C.buffer);c.value+=e.rleCompressedSize}for(var J=0,K=Array(q.length),r=0;r<K.length;++r)K[r]=[];for(var L=0;L<a.lines;++L)for(var M=0;M<q.length;++M)K[M].push(J),J+=q[M].width*a.type*2;!function(a,b,c,d,e,f){var h=new DataView(f.buffer),i=c[a.idx[0]].width,j=c[a.idx[0]].height,k=Math.floor(i/8),l=Math.ceil(i/8),m=Math.ceil(j/8),n=i-(l-1)*8,o=j-(m-1)*8,p={value:0},q=[,,,],r=[,,,],s=[,,,],t=[,,,],u=[,,,];for(let c=0;c<3;++c)u[c]=b[a.idx[c]],q[c]=c<1?0:q[c-1]+l*m,r[c]=new Float32Array(64),s[c]=new Uint16Array(64),t[c]=new Uint16Array(64*l);for(let b=0;b<m;++b){var v,w,x=8;b==m-1&&(x=o);var y=8;for(let a=0;a<l;++a){a==l-1&&(y=n);for(let a=0;a<3;++a){s[a].fill(0),s[a][0]=e[q[a]++],function(a,b,c){for(var d,e=1;e<64;)65280==(d=b[a.value])?e=64:d>>8==255?e+=255&d:(c[e]=d,e++),a.value++}(p,d,s[a]),v=s[a],(w=r[a])[0]=H(v[0]),w[1]=H(v[1]),w[2]=H(v[5]),w[3]=H(v[6]),w[4]=H(v[14]),w[5]=H(v[15]),w[6]=H(v[27]),w[7]=H(v[28]),w[8]=H(v[2]),w[9]=H(v[4]),w[10]=H(v[7]),w[11]=H(v[13]),w[12]=H(v[16]),w[13]=H(v[26]),w[14]=H(v[29]),w[15]=H(v[42]),w[16]=H(v[3]),w[17]=H(v[8]),w[18]=H(v[12]),w[19]=H(v[17]),w[20]=H(v[25]),w[21]=H(v[30]),w[22]=H(v[41]),w[23]=H(v[43]),w[24]=H(v[9]),w[25]=H(v[11]),w[26]=H(v[18]),w[27]=H(v[24]),w[28]=H(v[31]),w[29]=H(v[40]),w[30]=H(v[44]),w[31]=H(v[53]),w[32]=H(v[10]),w[33]=H(v[19]),w[34]=H(v[23]),w[35]=H(v[32]),w[36]=H(v[39]),w[37]=H(v[45]),w[38]=H(v[52]),w[39]=H(v[54]),w[40]=H(v[20]),w[41]=H(v[22]),w[42]=H(v[33]),w[43]=H(v[38]),w[44]=H(v[46]),w[45]=H(v[51]),w[46]=H(v[55]),w[47]=H(v[60]),w[48]=H(v[21]),w[49]=H(v[34]),w[50]=H(v[37]),w[51]=H(v[47]),w[52]=H(v[50]),w[53]=H(v[56]),w[54]=H(v[59]),w[55]=H(v[61]),w[56]=H(v[35]),w[57]=H(v[36]),w[58]=H(v[48]),w[59]=H(v[49]),w[60]=H(v[57]),w[61]=H(v[58]),w[62]=H(v[62]),w[63]=H(v[63]),function(a){let b=.5*Math.cos(3.14159/16),c=.5*Math.cos(3.14159/8),d=.5*Math.cos(3*3.14159/16),e=.5*Math.cos(3*3.14159/8);for(var f=[,,,,],g=[,,,,],h=[,,,,],i=[,,,,],j=0;j<8;++j){var k=8*j;f[0]=c*a[k+2],f[1]=e*a[k+2],f[2]=c*a[k+6],f[3]=e*a[k+6],g[0]=b*a[k+1]+d*a[k+3]+.2777854612564676*a[k+5]+.09754573032714427*a[k+7],g[1]=d*a[k+1]-.09754573032714427*a[k+3]-b*a[k+5]-.2777854612564676*a[k+7],g[2]=.2777854612564676*a[k+1]-b*a[k+3]+.09754573032714427*a[k+5]+d*a[k+7],g[3]=.09754573032714427*a[k+1]-.2777854612564676*a[k+3]+d*a[k+5]-b*a[k+7],h[0]=.35355362513961314*(a[k+0]+a[k+4]),h[3]=.35355362513961314*(a[k+0]-a[k+4]),h[1]=f[0]+f[3],h[2]=f[1]-f[2],i[0]=h[0]+h[1],i[1]=h[3]+h[2],i[2]=h[3]-h[2],i[3]=h[0]-h[1],a[k+0]=i[0]+g[0],a[k+1]=i[1]+g[1],a[k+2]=i[2]+g[2],a[k+3]=i[3]+g[3],a[k+4]=i[3]-g[3],a[k+5]=i[2]-g[2],a[k+6]=i[1]-g[1],a[k+7]=i[0]-g[0]}for(var l=0;l<8;++l)f[0]=c*a[16+l],f[1]=e*a[16+l],f[2]=c*a[48+l],f[3]=e*a[48+l],g[0]=b*a[8+l]+d*a[24+l]+.2777854612564676*a[40+l]+.09754573032714427*a[56+l],g[1]=d*a[8+l]-.09754573032714427*a[24+l]-b*a[40+l]-.2777854612564676*a[56+l],g[2]=.2777854612564676*a[8+l]-b*a[24+l]+.09754573032714427*a[40+l]+d*a[56+l],g[3]=.09754573032714427*a[8+l]-.2777854612564676*a[24+l]+d*a[40+l]-b*a[56+l],h[0]=.35355362513961314*(a[l]+a[32+l]),h[3]=.35355362513961314*(a[l]-a[32+l]),h[1]=f[0]+f[3],h[2]=f[1]-f[2],i[0]=h[0]+h[1],i[1]=h[3]+h[2],i[2]=h[3]-h[2],i[3]=h[0]-h[1],a[0+l]=i[0]+g[0],a[8+l]=i[1]+g[1],a[16+l]=i[2]+g[2],a[24+l]=i[3]+g[3],a[32+l]=i[3]-g[3],a[40+l]=i[2]-g[2],a[48+l]=i[1]-g[1],a[56+l]=i[0]-g[0]}(r[a])}for(var z=r,A=0;A<64;++A){var B=z[0][A],C=z[1][A],D=z[2][A];z[0][A]=B+1.5747*D,z[1][A]=B-.1873*C-.4682*D,z[2][A]=B+1.8556*C}for(let b=0;b<3;++b)!function(a,b,c){for(var d,e=0;e<64;++e){b[c+e]=g.DataUtils.toHalfFloat((d=a[e])<=1?Math.sign(d)*Math.pow(Math.abs(d),2.2):Math.sign(d)*Math.pow(9.025013291561939,Math.abs(d)-1))}}(r[b],t[b],64*a)}let f=0;for(let d=0;d<3;++d){let e=c[a.idx[d]].type;for(let a=8*b;a<8*b+x;++a){f=u[d][a];for(let b=0;b<k;++b){let c=64*b+(7&a)*8;h.setUint16(f+0*e,t[d][c+0],!0),h.setUint16(f+2*e,t[d][c+1],!0),h.setUint16(f+4*e,t[d][c+2],!0),h.setUint16(f+6*e,t[d][c+3],!0),h.setUint16(f+8*e,t[d][c+4],!0),h.setUint16(f+10*e,t[d][c+5],!0),h.setUint16(f+12*e,t[d][c+6],!0),h.setUint16(f+14*e,t[d][c+7],!0),f+=16*e}}if(k!=l)for(let a=8*b;a<8*b+x;++a){let b=u[d][a]+8*k*2*e,c=64*k+(7&a)*8;for(let a=0;a<y;++a)h.setUint16(b+2*a*e,t[d][c+a],!0)}}}for(var E=new Uint16Array(i),h=new DataView(f.buffer),F=0;F<3;++F){c[a.idx[F]].decoded=!0;var G=c[a.idx[F]].type;if(2==c[F].type)for(var I=0;I<j;++I){let a=u[F][I];for(var J=0;J<i;++J)E[J]=h.getUint16(a+2*J*G,!0);for(var J=0;J<i;++J)h.setFloat32(a+2*J*G,H(E[J]),!0)}}}(w,K,q,A,F,d);for(var r=0;r<q.length;++r){var t=q[r];if(!t.decoded)if(2===t.compression)for(var O=0,P=0,L=0;L<a.lines;++L){for(var Q=K[r][O],R=0;R<t.width;++R){for(var S=0;S<2*t.type;++S)d[Q++]=G[P+S*t.width*t.height];P++}O++}else throw"EXRLoader.parse: unsupported channel compression"}return new DataView(d.buffer)}function z(a,b){for(var c=new Uint8Array(a),d=0;0!=c[b.value+d];)d+=1;var e=new TextDecoder().decode(c.slice(b.value,b.value+d));return b.value=b.value+d+1,e}function A(a,b){var c=a.getInt32(b.value,!0);return b.value=b.value+4,c}function B(a,b){var c=a.getUint32(b.value,!0);return b.value=b.value+4,c}function C(a,b){var c=a[b.value];return b.value=b.value+1,c}function D(a,b){var c=a.getUint8(b.value);return b.value=b.value+1,c}let E=function(a,b){let c;return c="getBigInt64"in DataView.prototype?Number(a.getBigInt64(b.value,!0)):a.getUint32(b.value+4,!0)+Number(a.getUint32(b.value,!0)<<32),b.value+=8,c};function F(a,b){var c=a.getFloat32(b.value,!0);return b.value+=4,c}function G(a,b){return g.DataUtils.toHalfFloat(F(a,b))}function H(a){var b=(31744&a)>>10,c=1023&a;return(a>>15?-1:1)*(b?31===b?c?NaN:1/0:Math.pow(2,b-15)*(1+c/1024):c/1024*6103515625e-14)}function I(a,b){var c=a.getUint16(b.value,!0);return b.value+=2,c}function J(a,b){return H(I(a,b))}let K=new DataView(a),L=new Uint8Array(a),M={value:0},N=function(a,b,c){let d={};if(0x1312f76!=a.getUint32(0,!0))throw"THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.";d.version=a.getUint8(4);let e=a.getUint8(5);d.spec={singleTile:!!(2&e),longName:!!(4&e),deepFormat:!!(8&e),multiPart:!!(16&e)},c.value=8;for(var f=!0;f;){var g=z(b,c);if(0==g)f=!1;else{var h=z(b,c),i=B(a,c),j=function(a,b,c,d,e){var f,g,h,i,j,k,l;if("string"===d||"stringvector"===d||"iccProfile"===d)return f=new TextDecoder().decode(new Uint8Array(b).slice(c.value,c.value+e)),c.value=c.value+e,f;if("chlist"===d)return function(a,b,c,d){for(var e=c.value,f=[];c.value<e+d-1;){var g=z(b,c),h=A(a,c),i=D(a,c);c.value+=3;var j=A(a,c),k=A(a,c);f.push({name:g,pixelType:h,pLinear:i,xSampling:j,ySampling:k})}return c.value+=1,f}(a,b,c,e);if("chromaticities"===d)return g=F(a,c),h=F(a,c),i=F(a,c),j=F(a,c),k=F(a,c),{redX:g,redY:h,greenX:i,greenY:j,blueX:k,blueY:F(a,c),whiteX:F(a,c),whiteY:F(a,c)};if("compression"===d)return["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"][D(a,c)];if("box2i"===d)return l=B(a,c),{xMin:l,yMin:B(a,c),xMax:B(a,c),yMax:B(a,c)};else if("lineOrder"===d)return["INCREASING_Y"][D(a,c)];else if("float"===d)return F(a,c);else if("v2f"===d)return[F(a,c),F(a,c)];else if("v3f"===d)return[F(a,c),F(a,c),F(a,c)];else if("int"===d)return A(a,c);else if("rational"===d)return[A(a,c),B(a,c)];else if("timecode"===d)return[B(a,c),B(a,c)];else return"preview"===d?(c.value+=e,"skipped"):(c.value+=e,void 0)}(a,b,c,h,i);void 0===j?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${h}'.`):d[g]=j}}if((-5&e)!=0)throw console.error("EXRHeader:",d),"THREE.EXRLoader: provided file is currently unsupported.";return d}(K,a,M),O=function(a,b,c,d,e){let f={size:0,viewer:b,array:c,offset:d,width:a.dataWindow.xMax-a.dataWindow.xMin+1,height:a.dataWindow.yMax-a.dataWindow.yMin+1,channels:a.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:a.channels[0].pixelType,uncompress:null,getter:null,format:null,[i?"colorSpace":"encoding"]:null};switch(a.compression){case"NO_COMPRESSION":f.lines=1,f.uncompress=t;break;case"RLE_COMPRESSION":f.lines=1,f.uncompress=u;break;case"ZIPS_COMPRESSION":f.lines=1,f.uncompress=v;break;case"ZIP_COMPRESSION":f.lines=16,f.uncompress=v;break;case"PIZ_COMPRESSION":f.lines=32,f.uncompress=w;break;case"PXR24_COMPRESSION":f.lines=16,f.uncompress=x;break;case"DWAA_COMPRESSION":f.lines=32,f.uncompress=y;break;case"DWAB_COMPRESSION":f.lines=256,f.uncompress=y;break;default:throw"EXRLoader.parse: "+a.compression+" is unsupported"}if(f.scanlineBlockSize=f.lines,1==f.type)switch(e){case g.FloatType:f.getter=J,f.inputSize=2;break;case g.HalfFloatType:f.getter=I,f.inputSize=2}else if(2==f.type)switch(e){case g.FloatType:f.getter=F,f.inputSize=4;break;case g.HalfFloatType:f.getter=G,f.inputSize=4}else throw"EXRLoader.parse: unsupported pixelType "+f.type+" for "+a.compression+".";f.blockCount=(a.dataWindow.yMax+1)/f.scanlineBlockSize;for(var h=0;h<f.blockCount;h++)E(b,d);f.outputChannels=3==f.channels?4:f.channels;let j=f.width*f.height*f.outputChannels;switch(e){case g.FloatType:f.byteArray=new Float32Array(j),f.channels<f.outputChannels&&f.byteArray.fill(1,0,j);break;case g.HalfFloatType:f.byteArray=new Uint16Array(j),f.channels<f.outputChannels&&f.byteArray.fill(15360,0,j);break;default:console.error("THREE.EXRLoader: unsupported type: ",e)}return f.bytesPerLine=f.width*f.inputSize*f.channels,4==f.outputChannels?f.format=g.RGBAFormat:f.format=g.RedFormat,i?f.colorSpace="srgb-linear":f.encoding=3e3,f}(N,K,L,M,this.type),P={value:0},Q={R:0,G:1,B:2,A:3,Y:0};for(let a=0;a<O.height/O.scanlineBlockSize;a++){let b=B(K,M);O.size=B(K,M),O.lines=b+O.scanlineBlockSize>O.height?O.height-b:O.scanlineBlockSize;let c=O.size<O.lines*O.bytesPerLine?O.uncompress(O):t(O);M.value+=O.size;for(let b=0;b<O.scanlineBlockSize;b++){let d=b+a*O.scanlineBlockSize;if(d>=O.height)break;for(let a=0;a<O.channels;a++){let e=Q[N.channels[a].name];for(let f=0;f<O.width;f++){P.value=(b*(O.channels*O.width)+a*O.width+f)*O.inputSize;let g=(O.height-1-d)*(O.width*O.outputChannels)+f*O.outputChannels+e;O.byteArray[g]=O.getter(c,P)}}}}return{header:N,width:O.width,height:O.height,data:O.byteArray,format:O.format,[i?"colorSpace":"encoding"]:O[i?"colorSpace":"encoding"],type:this.type}}setDataType(a){return this.type=a,this}load(a,b,c,d){return super.load(a,function(a,c){i?a.colorSpace=c.colorSpace:a.encoding=c.encoding,a.minFilter=g.LinearFilter,a.magFilter=g.LinearFilter,a.generateMipmaps=!1,a.flipY=!1,b&&b(a,c)},c,d)}}var k=a.i(82038);let l=(a,b,c)=>{let d;switch(a){case e.UnsignedByteType:d=new Uint8ClampedArray(b*c*4);break;case e.HalfFloatType:d=new Uint16Array(b*c*4);break;case e.UnsignedIntType:d=new Uint32Array(b*c*4);break;case e.ByteType:d=new Int8Array(b*c*4);break;case e.ShortType:d=new Int16Array(b*c*4);break;case e.IntType:d=new Int32Array(b*c*4);break;case e.FloatType:d=new Float32Array(b*c*4);break;default:throw Error("Unsupported data type")}return d};class m{_renderer;_rendererIsDisposable=!1;_material;_scene;_camera;_quad;_renderTarget;_width;_height;_type;_colorSpace;_supportsReadPixels=!0;constructor(a){this._width=a.width,this._height=a.height,this._type=a.type,this._colorSpace=a.colorSpace;const c={format:e.RGBAFormat,depthBuffer:!1,stencilBuffer:!1,type:this._type,colorSpace:this._colorSpace,anisotropy:a.renderTargetOptions?.anisotropy!==void 0?a.renderTargetOptions?.anisotropy:1,generateMipmaps:a.renderTargetOptions?.generateMipmaps!==void 0&&a.renderTargetOptions?.generateMipmaps,magFilter:a.renderTargetOptions?.magFilter!==void 0?a.renderTargetOptions?.magFilter:e.LinearFilter,minFilter:a.renderTargetOptions?.minFilter!==void 0?a.renderTargetOptions?.minFilter:e.LinearFilter,samples:a.renderTargetOptions?.samples!==void 0?a.renderTargetOptions?.samples:void 0,wrapS:a.renderTargetOptions?.wrapS!==void 0?a.renderTargetOptions?.wrapS:e.ClampToEdgeWrapping,wrapT:a.renderTargetOptions?.wrapT!==void 0?a.renderTargetOptions?.wrapT:e.ClampToEdgeWrapping};if(this._material=a.material,a.renderer?this._renderer=a.renderer:(this._renderer=m.instantiateRenderer(),this._rendererIsDisposable=!0),this._scene=new e.Scene,this._camera=new e.OrthographicCamera,this._camera.position.set(0,0,10),this._camera.left=-.5,this._camera.right=.5,this._camera.top=.5,this._camera.bottom=-.5,this._camera.updateProjectionMatrix(),!((a,c,d,f)=>{if(void 0!==b)return b;let g=new e.WebGLRenderTarget(1,1,f);c.setRenderTarget(g);let h=new e.Mesh(new e.PlaneGeometry,new e.MeshBasicMaterial({color:0xffffff}));c.render(h,d),c.setRenderTarget(null);let i=l(a,g.width,g.height);return c.readRenderTargetPixels(g,0,0,g.width,g.height,i),g.dispose(),h.geometry.dispose(),h.material.dispose(),b=0!==i[0]})(this._type,this._renderer,this._camera,c)){let a;this._type===e.HalfFloatType&&(a=this._renderer.extensions.has("EXT_color_buffer_float")?e.FloatType:void 0),void 0!==a?(console.warn(`This browser does not support reading pixels from ${this._type} RenderTargets, switching to ${e.FloatType}`),this._type=a):(this._supportsReadPixels=!1,console.warn("This browser dos not support toArray or toDataTexture, calls to those methods will result in an error thrown"))}this._quad=new e.Mesh(new e.PlaneGeometry,this._material),this._quad.geometry.computeBoundingBox(),this._scene.add(this._quad),this._renderTarget=new e.WebGLRenderTarget(this.width,this.height,c),this._renderTarget.texture.mapping=a.renderTargetOptions?.mapping!==void 0?a.renderTargetOptions?.mapping:e.UVMapping}static instantiateRenderer(){let a=new k.WebGLRenderer;return a.setSize(128,128),a}render=()=>{this._renderer.setRenderTarget(this._renderTarget);try{this._renderer.render(this._scene,this._camera)}catch(a){throw this._renderer.setRenderTarget(null),a}this._renderer.setRenderTarget(null)};toArray(){if(!this._supportsReadPixels)throw Error("Can't read pixels in this browser");let a=l(this._type,this._width,this._height);return this._renderer.readRenderTargetPixels(this._renderTarget,0,0,this._width,this._height,a),a}toDataTexture(a){let b=new e.DataTexture(this.toArray(),this.width,this.height,e.RGBAFormat,this._type,a?.mapping||e.UVMapping,a?.wrapS||e.ClampToEdgeWrapping,a?.wrapT||e.ClampToEdgeWrapping,a?.magFilter||e.LinearFilter,a?.minFilter||e.LinearFilter,a?.anisotropy||1,e.LinearSRGBColorSpace);return b.generateMipmaps=a?.generateMipmaps!==void 0&&a?.generateMipmaps,b}disposeOnDemandRenderer(){this._renderer.setRenderTarget(null),this._rendererIsDisposable&&(this._renderer.dispose(),this._renderer.forceContextLoss())}dispose(a){this.disposeOnDemandRenderer(),a&&this.renderTarget.dispose(),this.material instanceof e.ShaderMaterial&&Object.values(this.material.uniforms).forEach(a=>{a.value instanceof e.Texture&&a.value.dispose()}),Object.values(this.material).forEach(a=>{a instanceof e.Texture&&a.dispose()}),this.material.dispose(),this._quad.geometry.dispose()}get width(){return this._width}set width(a){this._width=a,this._renderTarget.setSize(this._width,this._height)}get height(){return this._height}set height(a){this._height=a,this._renderTarget.setSize(this._width,this._height)}get renderer(){return this._renderer}get renderTarget(){return this._renderTarget}set renderTarget(a){this._renderTarget=a,this._width=a.width,this._height=a.height}get material(){return this._material}get type(){return this._type}get colorSpace(){return this._colorSpace}}var n=e;class o extends Error{}class p extends Error{}let q=(a,b,c)=>{let d=RegExp(`${b}="([^"]*)"`,"i").exec(a);if(d)return d[1];let e=RegExp(`<${b}[^>]*>([\\s\\S]*?)</${b}>`,"i").exec(a);if(e){let a=e[1].match(/<rdf:li>([^<]*)<\/rdf:li>/g);return a&&3===a.length?a.map(a=>a.replace(/<\/?rdf:li>/g,"")):e[1].trim()}if(void 0!==c)return c;throw Error(`Can't find ${b} in gainmap metadata`)};class r{options;constructor(a){this.options={debug:!!a&&void 0!==a.debug&&a.debug,extractFII:!a||void 0===a.extractFII||a.extractFII,extractNonFII:!a||void 0===a.extractNonFII||a.extractNonFII}}extract(a){return new Promise((b,c)=>{let d,e=this.options.debug,f=new DataView(a.buffer);if(65496!==f.getUint16(0))return void c(Error("Not a valid jpeg"));let g=f.byteLength,h=2,i=0;for(;h<g;){if(++i>250)return void c(Error(`Found no marker after ${i} loops `));if(255!==f.getUint8(h))return void c(Error(`Not a valid marker at offset 0x${h.toString(16)}, found: 0x${f.getUint8(h).toString(16)}`));if(d=f.getUint8(h+1),e&&console.log(`Marker: ${d.toString(16)}`),226===d){e&&console.log("Found APP2 marker (0xffe2)");let a=h+4;if(0x4d504600===f.getUint32(a)){let d,e=a+4;if(18761===f.getUint16(e))d=!1;else{if(19789!==f.getUint16(e))return void c(Error("No valid endianness marker found in TIFF header"));d=!0}if(42!==f.getUint16(e+2,!d))return void c(Error("Not valid TIFF data! (no 0x002A marker)"));let g=f.getUint32(e+4,!d);if(g<8)return void c(Error("Not valid TIFF data! (First offset less than 8)"));let h=e+g,i=f.getUint16(h,!d),j=h+2,k=0;for(let a=j;a<j+12*i;a+=12)45057===f.getUint16(a,!d)&&(k=f.getUint32(a+8,!d));let l=h+2+12*i+4,m=[];for(let a=l;a<l+16*k;a+=16){let b={MPType:f.getUint32(a,!d),size:f.getUint32(a+4,!d),dataOffset:f.getUint32(a+8,!d),dependantImages:f.getUint32(a+12,!d),start:-1,end:-1,isFII:!1};b.dataOffset?(b.start=e+b.dataOffset,b.isFII=!1):(b.start=0,b.isFII=!0),b.end=b.start+b.size,m.push(b)}if(this.options.extractNonFII&&m.length){let a=new Blob([f]),c=[];for(let b of m){if(b.isFII&&!this.options.extractFII)continue;let d=a.slice(b.start,b.end+1,"image/jpeg");c.push(d)}b(c)}}}h+=2+f.getUint16(h+2)}})}}let s=async a=>{let b=(a=>{let b,c=(b="undefined"!=typeof TextDecoder?new TextDecoder().decode(a):a.toString()).indexOf("<x:xmpmeta");for(;-1!==c;){let a=b.indexOf("x:xmpmeta>",c),d=b.slice(c,a+10);try{let a=q(d,"hdrgm:GainMapMin","0"),b=q(d,"hdrgm:GainMapMax"),c=q(d,"hdrgm:Gamma","1"),e=q(d,"hdrgm:OffsetSDR","0.015625"),f=q(d,"hdrgm:OffsetHDR","0.015625"),g=/hdrgm:HDRCapacityMin="([^"]*)"/.exec(d),h=g?g[1]:"0",i=/hdrgm:HDRCapacityMax="([^"]*)"/.exec(d);if(!i)throw Error("Incomplete gainmap metadata");let j=i[1];return{gainMapMin:Array.isArray(a)?a.map(a=>parseFloat(a)):[parseFloat(a),parseFloat(a),parseFloat(a)],gainMapMax:Array.isArray(b)?b.map(a=>parseFloat(a)):[parseFloat(b),parseFloat(b),parseFloat(b)],gamma:Array.isArray(c)?c.map(a=>parseFloat(a)):[parseFloat(c),parseFloat(c),parseFloat(c)],offsetSdr:Array.isArray(e)?e.map(a=>parseFloat(a)):[parseFloat(e),parseFloat(e),parseFloat(e)],offsetHdr:Array.isArray(f)?f.map(a=>parseFloat(a)):[parseFloat(f),parseFloat(f),parseFloat(f)],hdrCapacityMin:parseFloat(h),hdrCapacityMax:parseFloat(j)}}catch(a){}c=b.indexOf("<x:xmpmeta",a)}})(a);if(!b)throw new p("Gain map XMP metadata not found");let c=new r({extractFII:!0,extractNonFII:!0}),d=await c.extract(a);if(2!==d.length)throw new o("Gain map recovery image not found");return{sdr:new Uint8Array(await d[0].arrayBuffer()),gainMap:new Uint8Array(await d[1].arrayBuffer()),metadata:b}},t=a=>new Promise((b,c)=>{let d=document.createElement("img");d.onload=()=>{b(d)},d.onerror=a=>{c(a)},d.src=URL.createObjectURL(a)});class u extends n.Loader{_renderer;_renderTargetOptions;_internalLoadingManager;_config;constructor(a,b){super(b),this._config=a,a.renderer&&(this._renderer=a.renderer),this._internalLoadingManager=new n.LoadingManager}setRenderer(a){return this._renderer=a,this}setRenderTargetOptions(a){return this._renderTargetOptions=a,this}prepareQuadRenderer(){this._renderer||console.warn("WARNING: A Renderer was not passed to this Loader constructor or in setRenderer, the result of this Loader will need to be converted to a Data Texture with toDataTexture() before you can use it in your renderer.");let a=this._config.createMaterial({gainMapMax:[1,1,1],gainMapMin:[0,0,0],gamma:[1,1,1],offsetHdr:[1,1,1],offsetSdr:[1,1,1],hdrCapacityMax:1,hdrCapacityMin:0,maxDisplayBoost:1,gainMap:new n.Texture,sdr:new n.Texture});return this._config.createQuadRenderer({width:16,height:16,type:n.HalfFloatType,colorSpace:n.LinearSRGBColorSpace,material:a,renderer:this._renderer,renderTargetOptions:this._renderTargetOptions})}async processImages(a,b,c){let d,e,f=b?new Blob([b],{type:"image/jpeg"}):void 0,g=new Blob([a],{type:"image/jpeg"}),h=!1;if("undefined"==typeof createImageBitmap){let a=await Promise.all([f?t(f):Promise.resolve(void 0),t(g)]);e=a[0],d=a[1],h="flipY"===c}else{let a=await Promise.all([f?createImageBitmap(f,{imageOrientation:c||"flipY"}):Promise.resolve(void 0),createImageBitmap(g,{imageOrientation:c||"flipY"})]);e=a[0],d=a[1]}return{sdrImage:d,gainMapImage:e,needsFlip:h}}createTextures(a,b,c){let d=new n.Texture(b||new ImageData(2,2),n.UVMapping,n.ClampToEdgeWrapping,n.ClampToEdgeWrapping,n.LinearFilter,n.LinearMipMapLinearFilter,n.RGBAFormat,n.UnsignedByteType,1,n.LinearSRGBColorSpace);d.flipY=c,d.needsUpdate=!0;let e=new n.Texture(a,n.UVMapping,n.ClampToEdgeWrapping,n.ClampToEdgeWrapping,n.LinearFilter,n.LinearMipMapLinearFilter,n.RGBAFormat,n.UnsignedByteType,1,n.SRGBColorSpace);return e.flipY=c,e.needsUpdate=!0,{gainMap:d,sdr:e}}updateQuadRenderer(a,b,c,d,e){a.width=b.width,a.height=b.height,a.material.gainMap=c,a.material.sdr=d,a.material.gainMapMin=e.gainMapMin,a.material.gainMapMax=e.gainMapMax,a.material.offsetHdr=e.offsetHdr,a.material.offsetSdr=e.offsetSdr,a.material.gamma=e.gamma,a.material.hdrCapacityMin=e.hdrCapacityMin,a.material.hdrCapacityMax=e.hdrCapacityMax,a.material.maxDisplayBoost=Math.pow(2,e.hdrCapacityMax),a.material.needsUpdate=!0}}var v=e;let w=`
varying vec2 vUv;

void main() {
  vUv = uv;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,x=`
// min half float value
#define HALF_FLOAT_MIN vec3( -65504, -65504, -65504 )
// max half float value
#define HALF_FLOAT_MAX vec3( 65504, 65504, 65504 )

uniform sampler2D sdr;
uniform sampler2D gainMap;
uniform vec3 gamma;
uniform vec3 offsetHdr;
uniform vec3 offsetSdr;
uniform vec3 gainMapMin;
uniform vec3 gainMapMax;
uniform float weightFactor;

varying vec2 vUv;

void main() {
  vec3 rgb = texture2D( sdr, vUv ).rgb;
  vec3 recovery = texture2D( gainMap, vUv ).rgb;
  vec3 logRecovery = pow( recovery, gamma );
  vec3 logBoost = gainMapMin * ( 1.0 - logRecovery ) + gainMapMax * logRecovery;
  vec3 hdrColor = (rgb + offsetSdr) * exp2( logBoost * weightFactor ) - offsetHdr;
  vec3 clampedHdrColor = max( HALF_FLOAT_MIN, min( HALF_FLOAT_MAX, hdrColor ));
  gl_FragColor = vec4( clampedHdrColor , 1.0 );
}
`;class y extends v.ShaderMaterial{_maxDisplayBoost;_hdrCapacityMin;_hdrCapacityMax;constructor({gamma:a,offsetHdr:b,offsetSdr:c,gainMapMin:d,gainMapMax:e,maxDisplayBoost:f,hdrCapacityMin:g,hdrCapacityMax:h,sdr:i,gainMap:j}){super({name:"GainMapDecoderMaterial",vertexShader:w,fragmentShader:x,uniforms:{sdr:{value:i},gainMap:{value:j},gamma:{value:new v.Vector3(1/a[0],1/a[1],1/a[2])},offsetHdr:{value:new v.Vector3().fromArray(b)},offsetSdr:{value:new v.Vector3().fromArray(c)},gainMapMin:{value:new v.Vector3().fromArray(d)},gainMapMax:{value:new v.Vector3().fromArray(e)},weightFactor:{value:(Math.log2(f)-g)/(h-g)}},blending:v.NoBlending,depthTest:!1,depthWrite:!1}),this._maxDisplayBoost=f,this._hdrCapacityMin=g,this._hdrCapacityMax=h,this.needsUpdate=!0,this.uniformsNeedUpdate=!0}get sdr(){return this.uniforms.sdr.value}set sdr(a){this.uniforms.sdr.value=a}get gainMap(){return this.uniforms.gainMap.value}set gainMap(a){this.uniforms.gainMap.value=a}get offsetHdr(){return this.uniforms.offsetHdr.value.toArray()}set offsetHdr(a){this.uniforms.offsetHdr.value.fromArray(a)}get offsetSdr(){return this.uniforms.offsetSdr.value.toArray()}set offsetSdr(a){this.uniforms.offsetSdr.value.fromArray(a)}get gainMapMin(){return this.uniforms.gainMapMin.value.toArray()}set gainMapMin(a){this.uniforms.gainMapMin.value.fromArray(a)}get gainMapMax(){return this.uniforms.gainMapMax.value.toArray()}set gainMapMax(a){this.uniforms.gainMapMax.value.fromArray(a)}get gamma(){let a=this.uniforms.gamma.value;return[1/a.x,1/a.y,1/a.z]}set gamma(a){let b=this.uniforms.gamma.value;b.x=1/a[0],b.y=1/a[1],b.z=1/a[2]}get hdrCapacityMin(){return this._hdrCapacityMin}set hdrCapacityMin(a){this._hdrCapacityMin=a,this.calculateWeight()}get hdrCapacityMax(){return this._hdrCapacityMax}set hdrCapacityMax(a){this._hdrCapacityMax=a,this.calculateWeight()}get maxDisplayBoost(){return this._maxDisplayBoost}set maxDisplayBoost(a){this._maxDisplayBoost=Math.max(1,Math.min(65504,a)),this.calculateWeight()}calculateWeight(){let a=(Math.log2(this._maxDisplayBoost)-this._hdrCapacityMin)/(this._hdrCapacityMax-this._hdrCapacityMin);this.uniforms.weightFactor.value=Math.max(0,Math.min(1,a))}}k.WebGLRenderer;class z extends u{constructor(a,b){super({renderer:a,createMaterial:a=>new y(a),createQuadRenderer:a=>new m(a)},b)}async render(a,b,c,d){let{sdrImage:e,gainMapImage:f,needsFlip:g}=await this.processImages(c,d,"flipY"),{gainMap:h,sdr:i}=this.createTextures(e,f,g);this.updateQuadRenderer(a,e,h,i,b),a.render()}}class A extends z{load([a,b,c],d,e,f){let g,h,i,j=this.prepareQuadRenderer(),k=async()=>{if(g&&h&&i){try{await this.render(j,i,g,h)}catch(d){this.manager.itemError(a),this.manager.itemError(b),this.manager.itemError(c),"function"==typeof f&&f(d),j.disposeOnDemandRenderer();return}"function"==typeof d&&d(j),this.manager.itemEnd(a),this.manager.itemEnd(b),this.manager.itemEnd(c),j.disposeOnDemandRenderer()}},l=!0,m=0,n=0,o=!0,p=0,q=0,r=!0,s=0,t=0,u=()=>{"function"==typeof e&&e(new ProgressEvent("progress",{lengthComputable:l&&o&&r,loaded:n+q+t,total:m+p+s}))};this.manager.itemStart(a),this.manager.itemStart(b),this.manager.itemStart(c);let w=new v.FileLoader(this._internalLoadingManager);w.setResponseType("arraybuffer"),w.setRequestHeader(this.requestHeader),w.setPath(this.path),w.setWithCredentials(this.withCredentials),w.load(a,async a=>{if("string"==typeof a)throw Error("Invalid sdr buffer");g=a,await k()},a=>{l=a.lengthComputable,n=a.loaded,m=a.total,u()},b=>{this.manager.itemError(a),"function"==typeof f&&f(b)});let x=new v.FileLoader(this._internalLoadingManager);x.setResponseType("arraybuffer"),x.setRequestHeader(this.requestHeader),x.setPath(this.path),x.setWithCredentials(this.withCredentials),x.load(b,async a=>{if("string"==typeof a)throw Error("Invalid gainmap buffer");h=a,await k()},a=>{o=a.lengthComputable,q=a.loaded,p=a.total,u()},a=>{this.manager.itemError(b),"function"==typeof f&&f(a)});let y=new v.FileLoader(this._internalLoadingManager);return y.setRequestHeader(this.requestHeader),y.setPath(this.path),y.setWithCredentials(this.withCredentials),y.load(c,async a=>{if("string"!=typeof a)throw Error("Invalid metadata string");i=JSON.parse(a),await k()},a=>{r=a.lengthComputable,t=a.loaded,s=a.total,u()},a=>{this.manager.itemError(c),"function"==typeof f&&f(a)}),j}}class B extends z{load(a,b,c,d){let e=this.prepareQuadRenderer(),f=new v.FileLoader(this._internalLoadingManager);return f.setResponseType("arraybuffer"),f.setRequestHeader(this.requestHeader),f.setPath(this.path),f.setWithCredentials(this.withCredentials),this.manager.itemStart(a),f.load(a,async c=>{let f,g,h;if("string"==typeof c)throw Error("Invalid buffer, received [string], was expecting [ArrayBuffer]");let i=new Uint8Array(c);try{let a=await s(i);f=a.sdr,g=a.gainMap,h=a.metadata}catch(b){if(b instanceof p||b instanceof o)console.warn(`Failure to reconstruct an HDR image from ${a}: Gain map metadata not found in the file, HDRJPGLoader will render the SDR jpeg`),h={gainMapMin:[0,0,0],gainMapMax:[1,1,1],gamma:[1,1,1],hdrCapacityMin:0,hdrCapacityMax:1,offsetHdr:[0,0,0],offsetSdr:[0,0,0]},f=i;else throw b}try{await this.render(e,h,f.buffer,g?.buffer)}catch(b){this.manager.itemError(a),"function"==typeof d&&d(b),e.disposeOnDemandRenderer();return}"function"==typeof b&&b(e),this.manager.itemEnd(a),e.disposeOnDemandRenderer()},c,b=>{this.manager.itemError(a),"function"==typeof d&&d(b)}),e}}let C={apartment:"lebombo_1k.hdr",city:"potsdamer_platz_1k.hdr",dawn:"kiara_1_dawn_1k.hdr",forest:"forest_slope_1k.hdr",lobby:"st_fagans_interior_1k.hdr",night:"dikhololo_night_1k.hdr",park:"rooitou_park_1k.hdr",studio:"studio_small_03_1k.hdr",sunset:"venice_sunset_1k.hdr",warehouse:"empty_warehouse_01_1k.hdr"};var D=a.i(22767);let E="https://raw.githack.com/pmndrs/drei-assets/456060a26bbeb8fdf79326f224b6d99b8bcce736/hdri/",F=["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"];function G({files:a=F,path:b="",preset:f,colorSpace:g,extensions:h}={}){f&&(J(f),a=C[f],b=E);let i=Array.isArray(a),{extension:j,isCubemap:k}=K(a),l=L(j);if(!l)throw Error("useEnvironment: Unrecognized file extension: "+a);let m=(0,c.useThree)(a=>a.gl);(0,D.useLayoutEffect)(()=>{("webp"===j||"jpg"===j||"jpeg"===j)&&m.domElement.addEventListener("webglcontextlost",function(){d.useLoader.clear(l,i?[a]:a)},{once:!0})},[a,m.domElement]);let n=(0,d.useLoader)(l,i?[a]:a,a=>{("webp"===j||"jpg"===j||"jpeg"===j)&&a.setRenderer(m),null==a.setPath||a.setPath(b),h&&h(a)}),o=i?n[0]:n;if("jpg"===j||"jpeg"===j||"webp"===j){var p;o=null==(p=o.renderTarget)?void 0:p.texture}return o.mapping=k?e.CubeReflectionMapping:e.EquirectangularReflectionMapping,o.colorSpace=null!=g?g:k?"srgb":"srgb-linear",o}let H={files:F,path:"",preset:void 0,extensions:void 0};G.preload=a=>{let b={...H,...a},{files:c,path:e=""}=b,{preset:f,extensions:g}=b;f&&(J(f),c=C[f],e=E);let{extension:h}=K(c);if("webp"===h||"jpg"===h||"jpeg"===h)throw Error("useEnvironment: Preloading gainmaps is not supported");let i=L(h);if(!i)throw Error("useEnvironment: Unrecognized file extension: "+c);d.useLoader.preload(i,Array.isArray(c)?[c]:c,a=>{null==a.setPath||a.setPath(e),g&&g(a)})};let I={files:F,preset:void 0};function J(a){if(!(a in C))throw Error("Preset must be one of: "+Object.keys(C).join(", "))}function K(a){var b;let c=Array.isArray(a)&&6===a.length,d=Array.isArray(a)&&3===a.length&&a.some(a=>a.endsWith("json")),e=Array.isArray(a)?a[0]:a;return{extension:c?"cube":d?"webp":e.startsWith("data:application/exr")?"exr":e.startsWith("data:application/hdr")?"hdr":e.startsWith("data:image/jpeg")?"jpg":null==(b=e.split(".").pop())||null==(b=b.split("?"))||null==(b=b.shift())?void 0:b.toLowerCase(),isCubemap:c,isGainmap:d}}function L(a){return"cube"===a?e.CubeTextureLoader:"hdr"===a?f.RGBELoader:"exr"===a?j:"jpg"===a||"jpeg"===a?B:"webp"===a?A:null}G.clear=a=>{let b={...I,...a},{files:c}=b,{preset:e}=b;e&&(J(e),c=C[e]);let{extension:f}=K(c),g=L(f);if(!g)throw Error("useEnvironment: Unrecognized file extension: "+c);d.useLoader.clear(g,Array.isArray(c)?[c]:c)},a.s(["useEnvironment",()=>G],15523)},30081,15924,a=>{"use strict";var b=a.i(10730);function c(a,c,d,e){var f;return(f=class extends b.ShaderMaterial{constructor(f){for(const e in super({vertexShader:c,fragmentShader:d,...f}),a)this.uniforms[e]=new b.Uniform(a[e]),Object.defineProperty(this,e,{get(){return this.uniforms[e].value},set(a){this.uniforms[e].value=a}});this.uniforms=b.UniformsUtils.clone(this.uniforms),null==e||e(this)}}).key=b.MathUtils.generateUUID(),f}a.s(["shaderMaterial",()=>c],30081);let d=parseInt(b.REVISION.replace(/\D+/g,""));a.s(["version",()=>d],15924)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__6b868ea1._.js.map